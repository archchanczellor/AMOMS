<!--<link rel="import" href="../bower_components/paper-badge/paper-badge.html">-->
<dom-module id="appointment-page">

    <template>

        <style include="shared-styles">
            .horizontal-around {
                @apply(--layout-horizontal);
                @apply(--layout-around-justified);
            }
            .horizontal {
                @apply(--layout-horizontal);
            }
            .horizontal-center {
                @apply(--layout-horizontal);
                @apply(--layout-center);
            }
            .cancelled {
                background-color: #F44336;
                color: white
            }
            .in-progress {
                background-color: #FFFF00;
                color: black;
            }
            .completed {
                background-color:#00E676;
                color: black;
            }
            paper-material {
                padding: 10px;
                border-radius: 10px;
                margin: 5px;
                text-transform: uppercase;
            }
        </style>
        <firebase-app api-key="AIzaSyCKmg93dL5bhlwjv_Kd493mcLbUR0ok5sI"
                      name="secondary"
                      auth-domain="amoms-9ecf6.firebaseapp.com"
                      database-url="https://amoms-9ecf6.firebaseio.com"
                      storage-bucket="amoms-9ecf6.appspot.com"></firebase-app>
        <firebase-auth id="appointmentStatus" app-name="secondary" status="{{tempStatus}}" provider="google"
                       on-error="showError"></firebase-auth>
        <firebase-query
                id="queryAppointment"
                app-name="primary"
                path="/schedule/appointment/{uid}"
                data="{{dataQuery}}"></firebase-query>
        <firebase-document
                id="saveAppointmentStatus"
                app-name="primary"
                path="/schedule/appointment/{uid}"
                data="{{appointmentData}}"></firebase-document>
        <firebase-auth id="primaryAuth" app-name="primary" status="{{status}}" provider="google"
                       on-error="showError"></firebase-auth>
        <paper-dialog id="editAppointmentStatus"
                      no-cancel-on-outside-click
                      class=""
                      entry-animation="scale-up-animation"
                      exit-animation="fade-out-animation">
            <form is="iron-form" id="appointmentStatusForm">
                <h2>Edit Appointment Status</h2>
                    <div class="horizontal-around">
                        <div class="horizontal">
                            <div class="horizontal-center">
                            Appointment Status: &nbsp
                            </div>
                            <paper-material id="statusPill" elevation="1">
                                [[appointmentTest.status]]
                                <paper-dropdown-menu label="Appointment Status" id="editStatus" name="Status" required>
                                    <paper-menu class="dropdown-content" selected="{{_computeSelected(userEdit.status)}}">
                                        <paper-item name="upcoming" value="upcoming">Upcoming</paper-item>
                                        <paper-item name="cancelled" value="cancelled">Cancelled</paper-item>
                                        <paper-item name="in-progress" value="in-progress">In-Progress</paper-item>
                                        <paper-item name="complete" value="complete">Complete</paper-item>
                                        <paper-item name="no-show" value="no-show">No-show</paper-item>
                                    </paper-menu>
                                </paper-dropdown-menu>
                            </paper-material>
                        </div>
                        <div class="buttons">
                            <paper-button dialog-dismiss>Close</paper-button>
                            <paper-button on-tap="_saveStatus">Submit</paper-button>
                        </div>
                    </div>
            </form>
        </paper-dialog>
        <paper-toast id="appointmentToast" text="{{toastMessage}}"></paper-toast>
    </template>

    <script>
        Polymer({
            is: 'appointment-page',
            properties: {
                appointmentTest: {
                    type: Object,
                    value: {status: 'upcoming'}
                },
                userEdit: {
                    type: Object,
                    value: null
                },
                toastMessage: String,
                key: String
            },
            _computeSelected: function (status) {
                if (status == 'upcoming')
                    return 0;
                else if (status == 'cancelled')
                    return 1
                else if (status == 'in-progress')
                    return 2
                else if (status == 'complete')
                    return 3
                else
                    return 4
            },
            saveAppointmentData: function () {
                this.$.saveAppointmentData.data = {
                    status: this.$.status.value
                }
                this.$.saveAppointmentData.save('/schedule/appointment/{uid}', this.key).then(function () {
                    document.querySelector('#editAppointmentStatus').close();
                    document.querySelector('appointment-page').toastMessage = "User has been added!";
                }, function (e) {
                    document.querySelector('appointment-page').toastMessage = "Something seems to have gone wrong. Please Try again.";
                    document.querySelector('#appointmentToast').open();
                })

            },
            _saveAppointment: function () {
                var key = this.userEdit.$key;
                var tempData = $("#appointmentStatusForm :input").serializeObject();
                tempData.status = this.$.editStatus.value;
                this.$.saveAppointmentData.data = tempData;
                this.$.saveAppointmentData.save('/schedule/appointment/{uid}', key).then(function () {
                    document.querySelector('#editAppointmentStatus').close();
                    document.querySelector('appointment-page').toastMessage = "User has been updated!";
                    document.querySelector('#appointmentToast').open();
                    document.querySelector('appointment-page').userEdit = null;
                }, function () {
                    document.querySelector('appointment-page').toastMessage = "Something seems to have gone wrong. Please Try again.";
                    document.querySelector('#appointmentToast').open();
                })
            },
            observers: [
                'changedStatus(appointmentTest.status)'
            ],

            changedStatus: function(status) {
//                todo: fix this
            },

            ready: function() {
                switch(this.appointmentTest.status) {
                    case 'canceled':
                        this.$.statusPill.classList.add('canceled');
                        break;
                    case 'no-progress':
                        this.$.statusPill.classList.add('no-progress');
                        break;
                    case 'completed':
                        this.$.statusPill.classList.add('completed');
                        break;
                    default:
                        break;
                }
            }
        })
    </script>

</dom-module>